---
version: 1

kind: group

environment:
  resources:
    gpu:
      limits: 1

hptuning:
  concurrency: 5
  random_search:
    n_experiments: 5
  matrix:
    sgd_momentum_factor:
      uniform: 0.5:0.9 # Samples from uniform distribution over [low:hight)
    learning_rate:
      linspace: 0.001:0.1:10 # [start, stop, num] steps from start to stop
    train_batch_size:
      values: [64, 128, 256, 512, 1024]


declarations:
  arch: alexnet
  valid_batch_size: 100
  test_batch_size: 100
  workers: 2
  epochs: 5
  sgd_weight_decay: 0.0001
  seed: 1

build:
  image: pytorch/pytorch:1.0-cuda10.0-cudnn7-runtime
  build_steps:
    - apt-get update && apt-get install -y unzip man
    - "curl https://rclone.org/install.sh | bash"
    - pip install -r requirements.txt
  env_vars:
    - [http_proxy, "http://wwwproxy.se.example.com:8080"]
    - [https_proxy, "http://wwwproxy.se.example.com:8080"]
    - [no_proxy, ".se.example.com,polyaxon-polyaxon-api"]

run:
  cmd:  python3 main.py --arch={{ arch }} \
                        --batch-size={{ train_batch_size }} \
                        --valid-batch-size={{ valid_batch_size }} \
                        --test-batch-size={{ test_batch_size }} \
                        --workers={{ workers }} \
                        --epochs={{ epochs }} \
                        --learning-rate={{ learning_rate }} \
                        --momentum={{ sgd_momentum_factor }} \
                        --weight-decay={{ sgd_weight_decay }} \
                        --seed={{ seed }}
